(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{100:function(e,t){},125:function(e,t,s){"use strict";s.r(t);var a=s(0),n=s.n(a),o=s(19),r=s.n(o),i=s(15),c=(s(73),s(12)),l=s(13),m=s(16),u=s(14),h=s(17),g=s(62),d=s(9),p=s(10),f=s(3),v=s(26),E=s(58),b={socket:s.n(E)()("https://anonchat-backend.herokuapp.com/"),username:"",room:"",currentRoomUsers:[],numberOfUsersInCurrentRoom:0};var y=Object(v.b)(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_ROOM_DETAILS":return Object(p.a)({},e,t.data);case"UPDATE_USER_LIST":return Object(p.a)({},e,{currentRoomUsers:t.data});default:return e}});var S=function(e){function t(e){var s;return Object(c.a)(this,t),(s=Object(m.a)(this,Object(u.a)(t).call(this,e))).joinRoom=s.joinRoom.bind(Object(f.a)(s)),s.joinRandomRoom=s.joinRandomRoom.bind(Object(f.a)(s)),s._joinRoom=s._joinRoom.bind(Object(f.a)(s)),s}return Object(h.a)(t,e),Object(l.a)(t,[{key:"joinRoom",value:function(){var e=document.querySelector("#hash").value;this._joinRoom(e)}},{key:"joinRandomRoom",value:function(){var e=function(e){for(var t="",s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=s.length,n=0;n<e;n++)t+=s.charAt(Math.floor(Math.random()*a));return t}(64);this._joinRoom(e)}},{key:"_joinRoom",value:function(e){if(!(e.length&&/^[A-Za-z0-9]{64,}$/.test(e)))return console.log("Error: Invalid hash!"),!1;console.log("Loading chat ..."),this.props.socket.emit("join",e),this.props.socket.on("join-fail",function(){console.log("Error: Invalid hash!")}),this.props.socket.on("join-ack",function(e){var t=JSON.parse(e),s=t.room,a=t.username,n=t.users,o=t.numberOfUsers;y.dispatch({type:"SET_ROOM_DETAILS",data:{room:s,username:a,currentRoomUsers:n,numberOfUsersInCurrentRoom:o}}),window.location.hash="/chat"})}},{key:"render",value:function(){return n.a.createElement("div",{className:"fadein-right"},n.a.createElement("div",{className:"join-page-container"},n.a.createElement("h1",null,"ANONCHAT."),n.a.createElement("div",null,n.a.createElement("div",null,n.a.createElement("input",{type:"text",className:"join-input",placeholder:"room hash...",id:"hash"}),n.a.createElement("button",{onClick:this.joinRoom,className:"join-btn"},"JOIN")),n.a.createElement("br",null),"or"," ",n.a.createElement("a",{onClick:this.joinRandomRoom,className:"special create-chat"},"create chat"))))}}]),t}(a.Component),O=Object(i.b)(function(e){return Object(p.a)({},e)})(S),j=s(59),N=s(60),k=s(61),w=s.n(k);var U=function(e){return n.a.createElement("div",{className:"message"},n.a.createElement("div",{className:"pic"},n.a.createElement("img",{src:"http://www.gravatar.com/avatar/".concat(e.username,"?s=50&r=pg&d=identicon"),alt:"user icon"})),n.a.createElement("div",{className:"message-content"},n.a.createElement("span",{className:"sender-username"},e.username)," ",n.a.createElement("span",{className:"muted"},new Date(e.timestamp).toLocaleString()),n.a.createElement("p",{className:"message-body"},w()(e.message))))};var M=function(e){return n.a.createElement("div",{className:"message"},n.a.createElement("p",{className:"muted italic"},e.message))},R=function(e){function t(e){var s;return Object(c.a)(this,t),(s=Object(m.a)(this,Object(u.a)(t).call(this,e))).state={messages:[],message:"",usernameSuggestions:[],showUsernameSuggestions:!1,selectedUsernameSuggestion:-1,isModalOpen:!1},s.pushMessageIntoList=s.pushMessageIntoList.bind(Object(f.a)(s)),s.pushSystemMessageIntoList=s.pushSystemMessageIntoList.bind(Object(f.a)(s)),s.scrollToEndOfMessages=s.scrollToEndOfMessages.bind(Object(f.a)(s)),s.updateUsersList=s.updateUsersList.bind(Object(f.a)(s)),s.onMessageChange=s.onMessageChange.bind(Object(f.a)(s)),s.sendMessage=s.sendMessage.bind(Object(f.a)(s)),s.copyRoomName=s.copyRoomName.bind(Object(f.a)(s)),s.onMessageKeyDown=s.onMessageKeyDown.bind(Object(f.a)(s)),s}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentWillMount",value:function(){this.props&&this.props.room.length&&this.props.username.length||(window.location.hash="/")}},{key:"componentDidMount",value:function(){Notification.requestPermission(),this.props.socket.on("user-message",this.pushMessageIntoList),this.props.socket.on("system-message",this.pushSystemMessageIntoList),this.props.socket.on("user-list-update",this.updateUsersList);document.getElementById("hash-share-modal"),document.getElementById("myBtn"),document.getElementsByClassName("close")[0]}},{key:"updateUsersList",value:function(e){var t=JSON.parse(e);t=t.users||[],y.dispatch({type:"UPDATE_USER_LIST",data:t})}},{key:"pushSystemMessageIntoList",value:function(e){if("string"!==(typeof e).toLowerCase()||!e.length)return!1;this.setState({messages:this.state.messages.concat({message:e,username:null,timestamp:(new Date).toString()})},function(){var e=document.querySelector(".message-list");e.scrollTop=e.scrollHeight})}},{key:"scrollToEndOfMessages",value:function(){var e=document.querySelector(".message-list");e.scrollTop=e.scrollHeight}},{key:"pushMessageIntoList",value:function(e){var t=JSON.parse(e),s=this.state.messages.length,a=this.state.messages[s-1];if(t.timestamp||(t.timestamp=(new Date).toString()),Notification.permission&&new RegExp(this.props.username).test(t.message)){new Notification("".concat(t.username," has mentioned you in chat!"));var n=document.querySelector("#beeper");n&&n.play()}s&&t.username&&a.username===t.username?(a.message+="<br/>".concat(t.message),this.setState({messages:this.state.messages.slice(0,s-1).concat(a)},this.scrollToEndOfMessages)):this.setState({messages:this.state.messages.concat(t)},this.scrollToEndOfMessages)}},{key:"sendMessage",value:function(e){e.preventDefault();var t=document.querySelector("#msg"),s=t.value;if(!s||!s.length)return!1;this.props.socket.emit("user-message",JSON.stringify({message:s,room:this.props.room})),t.value=""}},{key:"copyRoomName",value:function(){var e=document.querySelector("#share-room-hash");return!!e&&(!!this.props.room&&(e.select(),document.execCommand("copy",!0),void console.log("Copied!")))}},{key:"onMessageChange",value:function(e){var t=this;this.setState({message:e.target.value},function(){if(t.state.showUsernameSuggestions){var e="".concat(t.state.message.split("@")[1],".*"),s=t.props.currentRoomUsers.filter(function(s){return new RegExp(e,"i").test(s)&&s!==t.props.username});s&&s.length?t.setState({usernameSuggestions:s,selectedUsernameSuggestion:0}):t.setState({showUsernameSuggestions:!1})}})}},{key:"onMessageKeyDown",value:function(e){if(console.log(e.keyCode),50===e.keyCode&&e.shiftKey)this.setState({showUsernameSuggestions:!0},this.showUsernameSuggestions);else if(!this.state.showUsernameSuggestions||9!==e.keyCode&&13!==e.keyCode)if(this.state.showUsernameSuggestions&&38===e.keyCode){if(e.preventDefault(),this.state.selectedUsernameSuggestion<=0)return;this.setState({selectedUsernameSuggestion:this.state.selectedUsernameSuggestion-1})}else if(this.state.showUsernameSuggestions&&40===e.keyCode){if(e.preventDefault(),this.state.selectedUsernameSuggestion>=this.state.usernameSuggestions.length-1)return;this.setState({selectedUsernameSuggestion:this.state.selectedUsernameSuggestion+1})}else 32===e.keyCode&&this.setState({showUsernameSuggestions:!1});else e.preventDefault(),this.setState({message:this.state.message.split("@")[0]+"@"+this.state.usernameSuggestions[this.state.selectedUsernameSuggestion],showUsernameSuggestions:!1})}},{key:"render",value:function(){var e=this;return n.a.createElement("div",{className:"fadein-right"},n.a.createElement(N.Beforeunload,{onBeforeunload:function(e){return e.preventDefault()}}),n.a.createElement("div",{className:"chat-page-container"},n.a.createElement("div",{className:"left-div"},n.a.createElement("div",null,n.a.createElement("h3",{className:"channel-literal"},"CHANNEL"),n.a.createElement("br",null),n.a.createElement("span",{className:"channel-name selected"},"#",this.props.room?this.props.room.slice(0,8):null,"..."),n.a.createElement("br",null),n.a.createElement("a",{id:"myBtn",onClick:function(){return e.setState({isModalOpen:!0})},className:"special"},"Invite a user")),n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("div",{className:"people"},n.a.createElement("h3",{className:"channel-literal"},"PEOPLE"),n.a.createElement("br",null),n.a.createElement("div",{className:"people-list"},this.props.currentRoomUsers?this.props.currentRoomUsers.map(function(t,s){return n.a.createElement("span",{key:s,className:"person"+(t===e.props.username?" active":"")},t)}):null))),n.a.createElement("div",{className:"main-div"},n.a.createElement("div",{className:"message-container"},n.a.createElement("div",{className:"message-list"},n.a.createElement(j.CSSTransitionGroup,{transitionName:"react-fadein",transitionEnterTimeout:100},this.state.messages?this.state.messages.map(function(e,t){return e.username?n.a.createElement(U,Object.assign({key:t},e)):n.a.createElement(M,Object.assign({key:t},e))}):null))),n.a.createElement("div",{className:"chat-bar"},this.state.showUsernameSuggestions&&this.state.usernameSuggestions.length?n.a.createElement("div",{className:"username-suggestions"},this.state.usernameSuggestions.map(function(t,s){return n.a.createElement("div",{className:"suggested-username "+(s===e.state.selectedUsernameSuggestion?"active":""),key:s},"@",t)})):null,n.a.createElement("div",{className:"message-input"},n.a.createElement("form",{onSubmit:this.sendMessage},n.a.createElement("input",{type:"text",id:"msg",placeholder:"Enter message and press enter...",autoComplete:"off",onChange:this.onMessageChange,onKeyDown:this.onMessageKeyDown,value:this.state.message})))))),n.a.createElement("div",{id:"hash-share-modal",className:"modal"+(this.state.isModalOpen?" modal-active":"")},n.a.createElement("div",{className:"modal-content"},n.a.createElement("span",{className:"close",onClick:function(){return e.setState({isModalOpen:!1})}},"\xd7"),n.a.createElement("p",null,"Note: Share the below hash to any user and ask them to input at home page"),n.a.createElement("input",{type:"text",id:"share-room-hash",defaultValue:this.props.room}),n.a.createElement("button",{id:"copy-btn",onClick:this.copyRoomName},"Copy"))))}}]),t}(a.Component),C=Object(i.b)(function(e){return Object(p.a)({},e)})(R),I=function(e){function t(){return Object(c.a)(this,t),Object(m.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return n.a.createElement(g.a,null,n.a.createElement(d.c,null,n.a.createElement(d.a,{exact:!0,path:"/",render:function(e){return n.a.createElement(O,e)}}),n.a.createElement(d.a,{exact:!0,path:"/chat",render:function(e){return n.a.createElement(C,e)}})))}}]),t}(n.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(n.a.createElement(i.a,{store:y},n.a.createElement(I,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},64:function(e,t,s){e.exports=s(125)},73:function(e,t,s){}},[[64,1,2]]]);
//# sourceMappingURL=main.5c590509.chunk.js.map